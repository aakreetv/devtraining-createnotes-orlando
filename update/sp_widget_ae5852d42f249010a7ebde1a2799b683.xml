<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, $location, spModal) {
    /* widget controller */
    var c = this;
    $scope.startDate = {
        value: ''
    };
    $scope.endDate = {
        value: ''
    };

 

    $scope.company = {
        displayValue: "",
        value: "",
        name: 'company'
    };
    $scope.cmdb_ci = {
        displayValue: "",
        value: "",
        name: 'cmdb_ci'
    };
    c.queryCompany = "customer=true";
    $scope.$on("field.change", function(evt, parms) {
        if (parms.field.name == 'company') {
            c.queryCI = "company=" + parms.field.value;
        }
    });

 

    var category = [/*{"name":"none","value":"--none--"},*/{"name":"AIX","value":"43"},{"name":"APPLICATION","value":"16"},{"name":"AS400","value":"6"},{"name":"ArcSight","value":"34"},{"name":"BACKUP","value":"13"},{"name":"DB2","value":"19"},{"name":"Datacenter_Environment_Monitoring","value":"31"},{"name":"EXCHANGE","value":"17"},{"name":"HP-Unix","value":"45"},{"name":"IDAM","value":"40"},{"name":"INFOSEC","value":"38"},{"name":"LOTUS NOTES","value":"15"},{"name":"Linux","value":"42"},{"name":"MIDDLEWARE","value":"24"},{"name":"MSSQL","value":"3"},{"name":"MYSQL","value":"22"},{"name":"NETWORK","value":"2"},{"name":"ORACLE FINANCIALS APPS","value":"23"},{"name":"ORACLE","value":"4"},{"name":"ROUTER","value":"8"},{"name":"RTA-UAFC","value":"30"},{"name":"SAP BASIS","value":"36"},{"name":"SAP","value":"11"},{"name":"SECURITY","value":"12"},{"name":"SERVER","value":"1"},{"name":"SIM ANALYSIS","value":"29"},{"name":"STORAGE","value":"14"},{"name":"SYBASE","value":"35"},{"name":"Security Management - Noor","value":"37"},{"name":"Server Management-AVPM","value":"39"},{"name":"Server Patch Management","value":"41"},{"name":"Solaris","value":"44"},{"name":"UNIX","value":"5"},{"name":"VMWARE","value":"25"},{"name":"VOICE","value":"18"}];
    c.options = category;
    c.sendOutage = function() {
        var requestBody = {};
        requestBody.companyId = $scope.company.value;
        requestBody.hostNames = $scope.cmdb_ci.displayValue;
        requestBody.domainId = c.data.category.value;
        requestBody.Remarks = $scope.remarks;
        requestBody.TicketNo = $scope.ticketNo;
        requestBody.startDateTime = $scope.startDate.value;
        requestBody.endDateTime = $scope.endDate.value;
        requestBody.userName = "";

 

        //alert(JSON.stringify(requestBody));

 

        if (requestBody.companyId != "" && requestBody.hostNames != "" && requestBody.domainId != "" && requestBody.startDateTime != "" && requestBody.endDateTime != "" && requestBody.Remarks != "" && requestBody.TicketNo != "") {

 

            c.server.get({
                action: 'sendOutage',
                body: requestBody
            }).then(function(response) {
                $scope.textMessgae = response.data.textMessgae;
                              c.clear();
            })

 

        }
            
    }
    
    c.clear = function(){
        $scope.company = {
        displayValue: "",
        value: "",
        name: 'company'
    };
        $scope.cmdb_ci = {
        displayValue: "",
        value: "",
        name: 'cmdb_ci'
    };
        $scope.remarks = "";
        $scope.ticketNo = "";
        $scope.endDate = {
        value: ''
    };
        $scope.startDate = {
        value: ''
    };
        c.data.category = category;
        //c.options = category;
    }

 

}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>fix_field</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>fixField</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    /* populate the 'data' object */
    /* e.g., data.table = $sp.getValue('table'); */

 

    if (input.action == 'sendOutage') {
        try {
            input.body.userName = gs.getUserName();
            var restMessageCall = new sn_ws.RESTMessageV2('Event Grid Outages', 'Send Outage');
            restMessageCall.setRequestBody(JSON.stringify(input.body));
            var response = restMessageCall.execute();
            data.textMessgae = response.getBody();
        } catch (ex) {
            var message = ex.message;
            gs.addErrorMessage(message);
        }

 

    }

 

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-04-29 09:25:07</sys_created_on>
        <sys_id>ae5852d42f249010a7ebde1a2799b683</sys_id>
        <sys_mod_count>7</sys_mod_count>
        <sys_name>fixField</sys_name>
        <sys_package display_value="CreateNotes" source="x_snc_createnotes">df5fd9a5090232007f44e1046c8ff69f</sys_package>
        <sys_policy/>
        <sys_scope display_value="CreateNotes">df5fd9a5090232007f44e1046c8ff69f</sys_scope>
        <sys_update_name>sp_widget_ae5852d42f249010a7ebde1a2799b683</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-04-29 10:29:16</sys_updated_on>
        <template><![CDATA[<div>
  
  <span ng-bind="textMessgae"></span>
  
    <form class="needs-validation">
        <div class="row">
        <div class="col-sm-4">
        <label class="control-label">Company</label>

 

           <sn-record-picker field="company" table="'core_company'" display-field="'name'" value-field="'sys_id'" search-fields="'name'" page-size="100"  default-query="c.queryCompany" required ></sn-record-picker>   
        <br><br>
      </div> 

 

      <div class="col-sm-4">
        <label class="control-label">Configuration items</label>
          <sn-record-picker sn-disabled="!company.value"  field="cmdb_ci" table="'cmdb_ci'" display-field="'name'" value-field="'sys_id'" search-fields="'name'" default-query="c.queryCI" page-size="100" required>
           </sn-record-picker>
        <br><br>
      </div>

 

      <div class="col-sm-4">
        <label class="control-label">Select a Category</label>
        <select ng-model="c.data.category" class="form-control" ng-init="c.data.category = c.options[0]" ng-options="option.name for option in options" required>        
        </select>
        <br><br>
      </div>
    </div>
    
    <div class="row">
       <div class="col-sm-3">
          <label class="control-label">Select Start Date</label>
          <!-- <input type="date" id="startDate" name="startDate" ng-model="startDate" class="form-control" name="startDate" placeholder="Start date" required />  -->
          <sp-date-picker field="startDate.value" ng-model="startDate.value" sn-include-time="true" required></sp-date-picker>
          <br><br>
        </div>

 

        <div class="col-sm-3">
          <label class="control-label">Select End Date</label>
          <!-- <input type="date" id="endDate" name="endDate" ng-model="endDate" class="form-control" name="endDate" placeholder="End date" required />  -->
          <sp-date-picker field="endDate.value" ng-model="endDate.value" sn-include-time="true" required></sp-date-picker>
        <br><br>
        </div>

 

        <div class="col-sm-3">
          <label class="control-label">Remarks</label>
          <input type="text" id="remarks" name="remarks" ng-model="remarks" class="form-control" name="remarks" placeholder="Remarks" required />
        <br><br>
        </div>
        <div class="col-sm-3">
          <label class="control-label">Ticket No</label>
          <input type="text" id="ticketNo" name="ticketNo" ng-model="ticketNo" class="form-control" name="ticketNo" placeholder="Ticket No" required />
        <br><br>
        </div>
      </div>
    <div>
           <button class="btn btn-primary" ng-click="c.sendOutage()">Set Outage</button>
          <button type="reset" class="btn btn-primary" ng-click="c.clear()">Clear</button>
    </div> 
  </form>    
</div>]]></template>
    </sp_widget>
</record_update>
